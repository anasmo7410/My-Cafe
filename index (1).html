<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØ§ÙÙŠÙ‡ - POS</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2c5f2d;
            --primary-dark: #1a3a1b;
            --secondary: #ff6b35;
            --success: #97cc04;
            --danger: #e63946;
            --warning: #ffa500;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --border: #e0e0e0;
            --shadow: rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px var(--shadow);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header h1 {
            color: var(--primary);
            font-size: 2em;
            font-weight: 900;
        }

        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .cash-display {
            background: linear-gradient(135deg, var(--success), var(--primary));
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            font-weight: 700;
            font-size: 1.2em;
        }

        .user-display {
            background: rgba(44, 95, 45, 0.1);
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 600;
            color: var(--primary);
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            background: white;
            padding: 15px;
            border-radius: 20px;
            box-shadow: 0 10px 40px var(--shadow);
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-tab {
            flex: 1;
            min-width: 150px;
            padding: 15px 25px;
            background: var(--light);
            border: none;
            border-radius: 15px;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-tab:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px var(--shadow);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px var(--shadow);
            margin-bottom: 20px;
        }

        .card-header {
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 10px;
        }

        .grid {
            display: grid;
            gap: 20px;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .tables-slider {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding: 10px 5px;
            scroll-behavior: smooth;
        }

        .tables-slider::-webkit-scrollbar {
            height: 8px;
        }

        .tables-slider::-webkit-scrollbar-track {
            background: var(--light);
            border-radius: 10px;
        }

        .tables-slider::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .table-item, .menu-item {
            background: var(--light);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
            cursor: pointer;
            min-width: 140px;
            flex-shrink: 0;
        }

        .table-item:hover, .menu-item:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px var(--shadow);
        }

        .table-item.selected {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-color: var(--primary-dark);
        }
        
        .table-item.occupied {
            background: #ffe6e6;
            border-color: var(--danger);
            opacity: 0.8;
        }
        
        .table-item.occupied:hover {
            border-color: var(--danger);
            transform: none;
            cursor: default;
        }

        .menu-item.selected {
            background: linear-gradient(135deg, var(--success), var(--primary));
            color: white;
            border-color: var(--success);
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(151, 204, 4, 0.4);
        }

        .menu-item.selected .item-price {
            color: white;
        }

        .item-name {
            font-weight: 700;
            font-size: 1.2em;
            margin-bottom: 8px;
        }

        .item-price {
            font-size: 1.3em;
            color: var(--success);
            font-weight: 700;
        }

        .table-status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            margin-top: 10px;
        }

        .status-available {
            background: var(--success);
            color: white;
        }

        .status-occupied {
            background: var(--danger);
            color: white;
        }

        .order-summary {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 15px;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            margin-bottom: 10px;
            border-radius: 10px;
        }

        .order-item-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .qty-btn {
            width: 35px;
            height: 35px;
            border: none;
            border-radius: 8px;
            background: var(--primary);
            color: white;
            font-size: 1.2em;
            cursor: pointer;
        }

        .qty-display {
            font-weight: 700;
            font-size: 1.2em;
            min-width: 40px;
            text-align: center;
        }

        .delete-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
        }

        .total-section {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .total-final {
            font-size: 1.8em;
            font-weight: 900;
            padding-top: 15px;
            border-top: 3px solid white;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-family: 'Cairo', sans-serif;
            font-weight: 600;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px var(--shadow);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #7da903);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #c41e3a);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #ff8c00);
            color: white;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-family: 'Cairo', sans-serif;
            font-size: 1em;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead th {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: right;
        }

        tbody td {
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex !important;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .close-modal {
            float: left;
            font-size: 2em;
            font-weight: 700;
            color: var(--danger);
            cursor: pointer;
        }

        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-card {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        @media print {
            body * { visibility: hidden; }
            .modal-content, .modal-content * { visibility: visible; }
            .modal-content {
                position: absolute;
                top: 0;
                left: 0;
                width: 80mm;
            }
            .close-modal, .print-button { display: none !important; }
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 1.5em; }
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen" style="display: none;">
        <div class="login-card">
            <div style="font-size: 4em; margin-bottom: 20px;">ğŸ‘¤</div>
            <h2 style="color: var(--primary); margin-bottom: 30px;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
            
            <div class="form-group" style="text-align: right;">
                <label>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                <select class="form-control" id="loginUser" style="font-size: 1.1em; padding: 15px;">
                    <option value="">-- Ø§Ø®ØªØ± --</option>
                    <option value="admin">ğŸ‘¨â€ğŸ’¼ Ø§Ù„Ù…Ø¯ÙŠØ± (ØµÙ„Ø§Ø­ÙŠØ§Øª ÙƒØ§Ù…Ù„Ø©)</option>
                    <option value="employee">ğŸ‘¨â€ğŸ³ Ù…ÙˆØ¸Ù (ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ø­Ø¯ÙˆØ¯Ø©)</option>
                </select>
            </div>

            <div class="form-group" id="employeeSelectGroup" style="display: none; text-align: right;">
                <label>Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù</label>
                <select class="form-control" id="employeeSelect" style="font-size: 1.1em; padding: 15px;">
                    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù --</option>
                </select>
            </div>

            <div class="form-group" style="text-align: right;">
                <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <input type="password" class="form-control" id="loginPassword" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" style="font-size: 1.1em; padding: 15px;">
                <small style="color: #666; margin-top: 5px; display: block;">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: 1234</small>
            </div>

            <button class="btn btn-success" onclick="performLogin()" style="width: 100%; font-size: 1.3em; padding: 15px; margin-top: 20px;">
                ğŸ”“ Ø¯Ø®ÙˆÙ„
            </button>
        </div>
    </div>

    <div class="container" id="mainContainer">
        <div class="header">
            <h1>â˜• Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØ§ÙÙŠÙ‡</h1>
            <div class="header-right">
                <div class="user-display" id="userDisplay">Ù…Ø³ØªØ®Ø¯Ù…</div>
                <div class="cash-display">
                    Ø§Ù„Ø®Ø²Ù†Ø©: <span id="totalCash">0.00</span> Ø¬
                </div>
                <button class="btn btn-danger" onclick="logout()" style="padding: 10px 20px;">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
            </div>
        </div>

        <div class="nav-tabs" id="navTabs">
            <button class="nav-tab active" onclick="showTab('cashier')">ğŸ’° Ø§Ù„ÙƒØ§Ø´ÙŠØ±</button>
            <button class="nav-tab" onclick="showTab('inventory')">ğŸ“¦ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</button>
            <button class="nav-tab" onclick="showTab('expenses')" id="expensesTab">ğŸ“¤ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</button>
            <button class="nav-tab" onclick="showTab('employees')" id="employeesTab">ğŸ‘¥ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</button>
            <button class="nav-tab" onclick="showTab('reports')">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
            <button class="nav-tab" onclick="showTab('settings')" id="settingsTab">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        </div>

        <!-- Cashier -->
        <div id="cashier" class="content-section active">
            <div class="card">
                <div class="card-header">Ø§Ø®ØªØ± Ø§Ù„Ø·Ø§ÙˆÙ„Ø© (Ø§Ø³Ø­Ø¨ â† â†’)</div>
                <div class="tables-slider" id="tablesGrid"></div>
            </div>

            <div class="grid grid-2">
                <div class="card">
                    <div class="card-header">Ø§Ù„Ù…Ù†ÙŠÙˆ</div>
                    <div class="grid grid-3" id="menuGrid"></div>
                </div>

                <div class="card">
                    <div class="card-header">Ø§Ù„Ø·Ù„Ø¨ - <span id="currentTable">Ø§Ø®ØªØ± Ø·Ø§ÙˆÙ„Ø©</span></div>
                    <div id="orderItems"></div>
                    <div class="total-section">
                        <div class="total-row">
                            <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</span>
                            <span id="subtotal">0.00</span>
                        </div>
                        <div class="total-row">
                            <span>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©:</span>
                            <span id="tax">0.00</span>
                        </div>
                        <div class="total-row total-final">
                            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                            <span id="total">0.00</span>
                        </div>
                    </div>
                    <button class="btn btn-success" style="width: 100%; margin-top: 20px; font-size: 1.2em;" onclick="completeSale()">
                        âœ“ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹ ÙˆØ·Ø¨Ø§Ø¹Ø©
                    </button>
                    <button class="btn btn-danger" style="width: 100%; margin-top: 10px;" onclick="clearOrder()">
                        âœ• Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨
                    </button>
                </div>
            </div>
        </div>

        <!-- Inventory -->
        <div id="inventory" class="content-section">
            <div class="card" id="inventoryManagement">
                <div class="card-header">Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù Ø¬Ø¯ÙŠØ¯</div>
                <div class="grid grid-3">
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù</label>
                        <input type="text" class="form-control" id="newItemName">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø³Ø¹Ø±</label>
                        <input type="number" class="form-control" id="newItemPrice">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„ÙƒÙ…ÙŠØ©</label>
                        <input type="number" class="form-control" id="newItemStock">
                    </div>
                </div>
                <button class="btn btn-success" onclick="addItem()">â• Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</button>
            </div>

            <div class="card">
                <div class="card-header">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù</div>
                <table id="inventoryTable">
                    <thead>
                        <tr>
                            <th>Ø§Ù„ØµÙ†Ù</th>
                            <th>Ø§Ù„Ø³Ø¹Ø±</th>
                            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                            <th id="inventoryActionsHeader">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Expenses -->
        <div id="expenses" class="content-section">
            <div class="card">
                <div class="card-header">Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ</div>
                <div class="grid grid-3">
                    <div class="form-group">
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ</label>
                        <input type="text" class="form-control" id="expenseType">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ù…Ø¨Ù„Øº</label>
                        <input type="number" class="form-control" id="expenseAmount">
                    </div>
                    <div class="form-group">
                        <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                        <input type="text" class="form-control" id="expenseNotes">
                    </div>
                </div>
                <button class="btn btn-warning" onclick="addExpense()">â• Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ</button>
            </div>

            <div class="card">
                <div class="card-header">Ø³Ø¬Ù„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div>
                <table id="expensesTable">
                    <thead>
                        <tr>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th>Ø§Ù„Ù†ÙˆØ¹</th>
                            <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                            <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Employees -->
        <div id="employees" class="content-section">
            <div class="card">
                <div class="card-header">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù</div>
                <div class="grid grid-3">
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</label>
                        <input type="text" class="form-control" id="empName">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„ÙˆØ¸ÙŠÙØ©</label>
                        <select class="form-control" id="empPosition">
                            <option>ÙƒØ§Ø´ÙŠØ±</option>
                            <option>Ø¨Ø§Ø±ÙŠØ³ØªØ§</option>
                            <option>ÙˆÙŠØªØ±</option>
                            <option>Ø·Ø¨Ø§Ø®</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ù…Ø±ØªØ¨</label>
                        <input type="number" class="form-control" id="empSalary">
                    </div>
                    <div class="form-group">
                        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" class="form-control" id="empPasswordNew" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…ÙˆØ¸Ù">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="addEmployee()">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù</button>
            </div>

            <div class="card">
                <div class="card-header">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</div>
                <div id="employeesContainer" style="margin-bottom: 20px;"></div>
                <table id="employeesTable">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø§Ù„ÙˆØ¸ÙŠÙØ©</th>
                            <th>Ø§Ù„Ù…Ø±ØªØ¨</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Reports -->
        <div id="reports" class="content-section">
            <div class="card">
                <div class="card-header">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div>
                <div id="financialStats" class="grid grid-3" style="margin-bottom: 30px;">
                    <div style="background: var(--success); color: white; padding: 30px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 2em; font-weight: 900;" id="reportSales">0.00</div>
                        <div style="margin-top: 10px;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div>
                    </div>
                    <div style="background: var(--danger); color: white; padding: 30px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 2em; font-weight: 900;" id="reportExpenses">0.00</div>
                        <div style="margin-top: 10px;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div>
                    </div>
                    <div style="background: var(--primary); color: white; padding: 30px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 2em; font-weight: 900;" id="reportProfit">0.00</div>
                        <div style="margin-top: 10px;">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</div>
                    </div>
                </div>

                <table id="salesTable">
                    <thead>
                        <tr>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th>Ø§Ù„Ø·Ø§ÙˆÙ„Ø©</th>
                            <th>Ø§Ù„ÙƒØ§Ø´ÙŠØ±</th>
                            <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            
            <!-- Daily Reports -->
            <div class="card" style="margin-top: 20px;">
                <div class="card-header">ğŸ“… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</div>
                <div style="margin-bottom: 20px;">
                    <label style="font-weight: 600; margin-bottom: 10px; display: block;">Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
                    <input type="date" id="dailyReportDate" class="form-control" style="max-width: 300px;">
                    <button class="btn btn-primary" onclick="generateDailyReport()" style="margin-top: 10px;">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                    <button class="btn btn-success" onclick="generateTodayReport()" style="margin-top: 10px; margin-right: 10px;">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…</button>
                </div>
                
                <div id="dailyReportContainer" style="display: none;">
                    <div id="dailyReportStats" class="grid grid-3" style="margin-bottom: 30px;"></div>
                    <table id="dailyReportTable">
                        <thead>
                            <tr>
                                <th>Ø§Ù„ÙˆÙ‚Øª</th>
                                <th>Ø§Ù„Ø·Ø§ÙˆÙ„Ø©</th>
                                <th>Ø§Ù„ÙƒØ§Ø´ÙŠØ±</th>
                                <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Settings -->
        <div id="settings" class="content-section">
            <div class="card">
                <div class="card-header">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙƒØ§ÙÙŠÙ‡</div>
                <div class="grid grid-2">
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„ÙƒØ§ÙÙŠÙ‡</label>
                        <input type="text" class="form-control" id="cafeName" value="ÙƒØ§ÙÙŠÙ‡ Ø§Ù„Ù†Ø¬Ø§Ø­">
                    </div>
                    <div class="form-group">
                        <label>Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†</label>
                        <input type="text" class="form-control" id="cafePhone" value="01000000000">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                        <input type="text" class="form-control" id="cafeAddress" value="Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©ØŒ Ù…ØµØ±">
                    </div>
                    <div class="form-group">
                        <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (%)</label>
                        <input type="number" class="form-control" id="taxRate" value="10">
                    </div>
                </div>
                <button class="btn btn-success" onclick="saveSettings()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
            </div>

            <div class="card">
                <div class="card-header">ğŸ” Ø¥Ø¯Ø§Ø±Ø© ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±</div>
                <div class="grid grid-2">
                    <div class="form-group">
                        <label>ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¯ÙŠØ±</label>
                        <input type="password" class="form-control" id="adminPassword" placeholder="Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: 1234">
                    </div>
                    <div class="form-group">
                        <label>ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</label>
                        <input type="password" class="form-control" id="employeePassword" placeholder="Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: 1234">
                    </div>
                </div>
                <button class="btn btn-warning" onclick="savePasswords()">ğŸ”‘ ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±</button>
            </div>

            <div class="card">
                <div class="card-header">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
                <button class="btn btn-danger" onclick="resetData()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </div>
        </div>
    </div>

    <!-- Invoice Modal -->
    <div id="invoiceModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeInvoice()">Ã—</span>
            <div id="invoiceContent"></div>
            <button class="btn btn-success" style="width: 100%; margin-top: 20px;" onclick="window.print()">
                ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
            </button>
        </div>
    </div>

    <script>
        // Data
        let data = {
            tables: [],
            menu: [],
            sales: [],
            expenses: [],
            employees: [],
            settings: {
                cafeName: 'ÙƒØ§ÙÙŠÙ‡ Ø§Ù„Ù†Ø¬Ø§Ø­',
                cafePhone: '01000000000',
                cafeAddress: 'Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©ØŒ Ù…ØµØ±',
                taxRate: 10,
                adminPassword: '1234',
                employeePassword: '1234'
            },
            currentOrder: { table: null, items: [] },
            currentUser: null,
            tableOrders: {} // Store ongoing orders for occupied tables
        };

        // Initialize
        function init() {
            console.log('Initializing...');
            
            // Load data
            const saved = localStorage.getItem('cafeData');
            if (saved) {
                const loadedData = JSON.parse(saved);
                // Merge loaded data with default structure to ensure settings exist
                data = {
                    tables: loadedData.tables || [],
                    menu: loadedData.menu || [],
                    sales: loadedData.sales || [],
                    expenses: loadedData.expenses || [],
                    employees: loadedData.employees || [],
                    settings: {
                        cafeName: loadedData.settings?.cafeName || 'ÙƒØ§ÙÙŠÙ‡ Ø§Ù„Ù†Ø¬Ø§Ø­',
                        cafePhone: loadedData.settings?.cafePhone || '01000000000',
                        cafeAddress: loadedData.settings?.cafeAddress || 'Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©ØŒ Ù…ØµØ±',
                        taxRate: loadedData.settings?.taxRate || 10,
                        adminPassword: loadedData.settings?.adminPassword || '1234',
                        employeePassword: loadedData.settings?.employeePassword || '1234'
                    },
                    currentOrder: loadedData.currentOrder || { table: null, items: [] },
                    currentUser: loadedData.currentUser || null,
                    tableOrders: loadedData.tableOrders || {} // Load ongoing orders
                };
                console.log('Data loaded', data.settings);
            } else {
                // Initialize default data
                for (let i = 1; i <= 20; i++) {
                    data.tables.push({ id: i, name: `Ø·Ø§ÙˆÙ„Ø© ${i}`, status: 'available' });
                }
                
                const defaultMenu = [
                    { id: 1, name: 'Ù‚Ù‡ÙˆØ© ØªØ±ÙƒÙŠ', price: 25, stock: 100 },
                    { id: 2, name: 'Ù‚Ù‡ÙˆØ© ÙØ±Ù†Ø³Ø§ÙˆÙŠ', price: 30, stock: 100 },
                    { id: 3, name: 'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ', price: 35, stock: 100 },
                    { id: 4, name: 'Ù„Ø§ØªÙŠÙ‡', price: 35, stock: 100 },
                    { id: 5, name: 'Ø¥Ø³Ø¨Ø±ÙŠØ³Ùˆ', price: 20, stock: 100 },
                    { id: 6, name: 'Ø´Ø§ÙŠ', price: 15, stock: 100 },
                    { id: 7, name: 'Ø¹ØµÙŠØ± Ø¨Ø±ØªÙ‚Ø§Ù„', price: 25, stock: 50 },
                    { id: 8, name: 'Ø¹ØµÙŠØ± Ù…Ø§Ù†Ø¬Ùˆ', price: 30, stock: 50 },
                    { id: 9, name: 'ÙƒØ±ÙŠØ¨ Ù†ÙˆØªÙŠÙ„Ø§', price: 40, stock: 30 },
                    { id: 10, name: 'ÙƒÙŠÙƒ Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©', price: 35, stock: 20 }
                ];
                data.menu = defaultMenu;
                console.log('Default data initialized');
                saveData(); // Save initial data
            }

            // Check login
            if (!data.currentUser) {
                showLoginScreen();
                return;
            }

            renderTables();
            renderMenu();
            renderInventory();
            renderExpenses();
            renderEmployees();
            updateReports();
            updateCash();
            updateUserDisplay();
            applyRoleRestrictions();
            
            console.log('Init complete!');
        }

        function saveData() {
            localStorage.setItem('cafeData', JSON.stringify(data));
        }

        // Login System
        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainContainer').style.display = 'none';
        }

        function hideLoginScreen() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainContainer').style.display = 'block';
        }

        document.getElementById('loginUser').addEventListener('change', function() {
            const empGroup = document.getElementById('employeeSelectGroup');
            if (this.value === 'employee') {
                empGroup.style.display = 'block';
                loadEmployeesForLogin();
            } else {
                empGroup.style.display = 'none';
            }
        });

        function loadEmployeesForLogin() {
            const select = document.getElementById('employeeSelect');
            select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù --</option>' + 
                data.employees.map(emp => `<option value="${emp.id}">${emp.name} - ${emp.position}</option>`).join('');
        }

        function performLogin() {
            const userType = document.getElementById('loginUser').value;
            const password = document.getElementById('loginPassword').value;

            console.log('Login attempt:', { userType, password });
            console.log('Settings:', data.settings);
            console.log('Admin password:', data.settings.adminPassword);

            if (!userType) {
                alert('âš ï¸ Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
                return;
            }

            if (!password) {
                alert('âš ï¸ Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
                return;
            }

            if (userType === 'admin') {
                console.log('Checking admin password:', password, '===', data.settings.adminPassword);
                if (password === data.settings.adminPassword) {
                    data.currentUser = { type: 'admin', name: 'Ø§Ù„Ù…Ø¯ÙŠØ±' };
                    completeLogin();
                } else {
                    alert('âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©\nÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù‡ÙŠ: 1234');
                }
            } else if (userType === 'employee') {
                const empId = document.getElementById('employeeSelect').value;
                if (!empId) {
                    alert('âš ï¸ Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù Ø£ÙˆÙ„Ø§Ù‹\n(Ù„Ø§Ø²Ù… ØªØ¶ÙŠÙ Ù…ÙˆØ¸ÙÙŠÙ† Ù…Ù† Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø£ÙˆÙ„)');
                    return;
                }

                const employee = data.employees.find(e => e.id == empId);
                
                // Check individual employee password
                const employeePassword = employee.password || '1234'; // Default if no password set
                console.log('Checking employee password:', password, '===', employeePassword);
                
                if (password === employeePassword) {
                    data.currentUser = {
                        type: 'employee',
                        name: employee.name,
                        id: employee.id,
                        position: employee.position
                    };
                    completeLogin();
                } else {
                    alert('âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©');
                }
            }
        }

        function completeLogin() {
            hideLoginScreen();
            saveData();
            renderTables();
            renderMenu();
            renderInventory();
            renderExpenses();
            renderEmployees();
            updateReports();
            updateCash();
            updateUserDisplay();
            applyRoleRestrictions();
        }

        function updateUserDisplay() {
            const display = document.getElementById('userDisplay');
            if (data.currentUser) {
                display.textContent = data.currentUser.type === 'admin' ? 
                    'ğŸ‘¨â€ğŸ’¼ ' + data.currentUser.name : 
                    'ğŸ‘¨â€ğŸ³ ' + data.currentUser.name;
            }
        }

        function logout() {
            if (confirm('ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
                data.currentUser = null;
                saveData();
                document.getElementById('loginPassword').value = '';
                document.getElementById('loginUser').value = '';
                showLoginScreen();
            }
        }

        function applyRoleRestrictions() {
            if (data.currentUser && data.currentUser.type === 'employee') {
                // Hide tabs that employees shouldn't access
                document.getElementById('expensesTab').style.display = 'none';
                document.getElementById('employeesTab').style.display = 'none';
                document.getElementById('settingsTab').style.display = 'none';
                
                // Hide cash display in header
                document.getElementById('totalCash').textContent = '***';
                
                // Hide financial statistics in reports (but keep the reports tab visible)
                const financialStats = document.getElementById('financialStats');
                if (financialStats) {
                    financialStats.style.display = 'none';
                }
                
                // Hide inventory management (adding/editing items)
                const inventoryManagement = document.getElementById('inventoryManagement');
                if (inventoryManagement) {
                    inventoryManagement.style.display = 'none';
                }
                
                // Hide actions column header in inventory
                const actionsHeader = document.getElementById('inventoryActionsHeader');
                if (actionsHeader) {
                    actionsHeader.style.display = 'none';
                }
            } else {
                // Show all tabs for admin
                document.getElementById('expensesTab').style.display = 'block';
                document.getElementById('employeesTab').style.display = 'block';
                document.getElementById('settingsTab').style.display = 'block';
                
                // Show financial statistics
                const financialStats = document.getElementById('financialStats');
                if (financialStats) {
                    financialStats.style.display = 'grid';
                }
                
                // Show inventory management
                const inventoryManagement = document.getElementById('inventoryManagement');
                if (inventoryManagement) {
                    inventoryManagement.style.display = 'block';
                }
                
                // Show actions column header in inventory
                const actionsHeader = document.getElementById('inventoryActionsHeader');
                if (actionsHeader) {
                    actionsHeader.style.display = 'table-cell';
                }
            }
        }

        // Tables
        function renderTables() {
            const grid = document.getElementById('tablesGrid');
            grid.innerHTML = data.tables.map(t => `
                <div class="table-item ${data.currentOrder.table === t.id ? 'selected' : ''} ${t.status === 'occupied' && data.currentOrder.table !== t.id ? 'occupied' : ''}" onclick="selectTable(${t.id})">
                    <div class="item-name">${t.name}</div>
                    <span class="table-status status-${t.status}">
                        ${t.status === 'available' ? 'âœ“ Ù…ØªØ§Ø­Ø©' : 'âœ• Ù…Ø´ØºÙˆÙ„Ø©'}
                    </span>
                    ${t.status === 'occupied' && data.currentOrder.table !== t.id ? `
                        <button class="btn btn-warning" style="padding: 8px 12px; font-size: 0.9em; margin-top: 5px; width: 100%;" onclick="event.stopPropagation(); addToOccupiedTable(${t.id})">
                            â• Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨
                        </button>
                        <button class="btn btn-success" style="padding: 8px 12px; font-size: 0.9em; margin-top: 5px; width: 100%;" onclick="event.stopPropagation(); releaseTable(${t.id})">
                            ØªØ­Ø±ÙŠØ± Ø§Ù„Ø·Ø§ÙˆÙ„Ø©
                        </button>
                    ` : ''}
                </div>
            `).join('');
        }

        function selectTable(id) {
            const table = data.tables.find(t => t.id === id);
            
            // Check if table is occupied (and not already selected for adding items)
            if (table.status === 'occupied' && data.currentOrder.table !== id) {
                // Don't show alert - user should use the "Add Order" button
                return;
            }
            
            data.currentOrder.table = id;
            document.getElementById('currentTable').textContent = table.name;
            renderTables();
        }
        
        function addToOccupiedTable(tableId) {
            if (data.currentOrder.items.length > 0 && data.currentOrder.table !== tableId) {
                if (!confirm('Ù„Ø¯ÙŠÙƒ Ø·Ù„Ø¨ Ø­Ø§Ù„ÙŠ ØºÙŠØ± Ù…ÙƒØªÙ…Ù„. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù„ØºØ§Ø¦Ù‡ ÙˆØ§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø·Ø§ÙˆÙ„Ø©ØŸ')) {
                    return;
                }
            }
            
            const table = data.tables.find(t => t.id === tableId);
            data.currentOrder.table = tableId;
            data.currentOrder.items = []; // Start fresh for new addition
            
            document.getElementById('currentTable').textContent = table.name + ' (Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨)';
            
            // Show previous order info if exists
            if (data.tableOrders[tableId]) {
                const prevTotal = data.tableOrders[tableId].total || 0;
                alert(`ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø§Ø¨Ù‚: ${prevTotal.toFixed(2)} Ø¬\nØ£Ø¶Ù Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙˆØ³ÙŠØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ`);
            }
            
            renderTables();
            renderOrder();
            renderMenu();
        }
        
        function releaseTable(tableId) {
            const table = data.tables.find(t => t.id === tableId);
            const tableOrder = data.tableOrders[tableId];
            
            if (!tableOrder || tableOrder.total === 0) {
                // No orders on this table, just release it
                table.status = 'available';
                delete data.tableOrders[tableId];
                saveData();
                renderTables();
                return;
            }
            
            // Show confirmation with total
            if (confirm(`Ù‡Ù„ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø²Ø¨Ø§ÙŠÙ† Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø·Ø§ÙˆÙ„Ø©ØŸ\n\nØ§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${tableOrder.total.toFixed(2)} Ø¬`)) {
                // Record final sale
                const finalSale = {
                    id: Date.now(),
                    date: new Date().toISOString(),
                    table: table.name,
                    items: tableOrder.items,
                    subtotal: tableOrder.subtotal,
                    tax: tableOrder.tax,
                    total: tableOrder.total,
                    employee: data.currentUser ? data.currentUser.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'
                };
                
                data.sales.push(finalSale);
                
                // Release table
                table.status = 'available';
                delete data.tableOrders[tableId];
                
                // If this was the current selected table, clear it
                if (data.currentOrder.table === tableId) {
                    data.currentOrder.table = null;
                    data.currentOrder.items = [];
                    document.getElementById('currentTable').textContent = 'Ø§Ø®ØªØ± Ø·Ø§ÙˆÙ„Ø©';
                    renderOrder();
                }
                
                saveData();
                renderTables();
                updateCash();
                updateReports();
                
                alert(`âœ… ØªÙ… ØªØ­Ø±ÙŠØ± Ø§Ù„Ø·Ø§ÙˆÙ„Ø©\nğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${tableOrder.total.toFixed(2)} Ø¬`);
            }
        }

        // Menu
        function renderMenu() {
            const grid = document.getElementById('menuGrid');
            grid.innerHTML = data.menu.map(item => {
                const inOrder = data.currentOrder.items.find(i => i.id === item.id);
                const isSelected = inOrder ? 'selected' : '';
                return `
                <div class="menu-item ${isSelected}" onclick="addToOrder(${item.id})">
                    <div class="item-name">${item.name}</div>
                    <div class="item-price">${item.price.toFixed(2)} Ø¬</div>
                    <div style="font-size: 0.9em; margin-top: 5px;">Ù…ØªÙˆÙØ±: ${item.stock}</div>
                    ${inOrder ? `<div style="color: white; font-weight: 700; margin-top: 5px; background: rgba(255,255,255,0.2); padding: 5px; border-radius: 5px;">âœ“ ÙÙŠ Ø§Ù„Ø·Ù„Ø¨ (${inOrder.quantity})</div>` : ''}
                </div>
            `;
            }).join('');
        }

        function addToOrder(itemId) {
            if (!data.currentOrder.table) {
                alert('âš ï¸ Ø§Ø®ØªØ± Ø·Ø§ÙˆÙ„Ø© Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }

            const item = data.menu.find(m => m.id === itemId);
            if (item.stock <= 0) {
                alert('âš ï¸ Ø§Ù„ØµÙ†Ù ØºÙŠØ± Ù…ØªØ§Ø­');
                return;
            }

            const existing = data.currentOrder.items.find(i => i.id === itemId);
            if (existing) {
                if (existing.quantity >= item.stock) {
                    alert(`âš ï¸ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø© ÙÙ‚Ø· ${item.stock}`);
                    return;
                }
                existing.quantity++;
            } else {
                data.currentOrder.items.push({
                    id: item.id,
                    name: item.name,
                    price: item.price,
                    quantity: 1
                });
            }

            renderOrder();
            renderMenu(); // Refresh menu to show selected state
        }

        function renderOrder() {
            const container = document.getElementById('orderItems');
            
            if (data.currentOrder.items.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ›’</div><div>Ø§Ù„Ø·Ù„Ø¨ ÙØ§Ø±Øº</div></div>';
                updateTotals();
                return;
            }

            container.innerHTML = data.currentOrder.items.map(item => `
                <div class="order-item">
                    <div>
                        <div style="font-weight: 700; margin-bottom: 5px;">${item.name}</div>
                        <div>${item.price.toFixed(2)} Ã— ${item.quantity} = ${(item.price * item.quantity).toFixed(2)} Ø¬</div>
                    </div>
                    <div class="order-item-controls">
                        <button class="qty-btn" onclick="changeQty(${item.id}, -1)">-</button>
                        <span class="qty-display">${item.quantity}</span>
                        <button class="qty-btn" onclick="changeQty(${item.id}, 1)">+</button>
                        <button class="delete-btn" onclick="removeItem(${item.id})">âœ•</button>
                    </div>
                </div>
            `).join('');

            updateTotals();
        }

        function changeQty(id, delta) {
            const item = data.currentOrder.items.find(i => i.id === id);
            const menuItem = data.menu.find(m => m.id === id);
            
            if (item) {
                const newQty = item.quantity + delta;
                if (newQty <= 0) {
                    removeItem(id);
                } else if (newQty > menuItem.stock) {
                    alert(`âš ï¸ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø© ÙÙ‚Ø· ${menuItem.stock}`);
                } else {
                    item.quantity = newQty;
                    renderOrder();
                    renderMenu(); // Refresh menu to update selected state
                }
            }
        }

        function removeItem(id) {
            data.currentOrder.items = data.currentOrder.items.filter(i => i.id !== id);
            renderOrder();
            renderMenu(); // Refresh menu to remove selected state
        }

        function updateTotals() {
            const subtotal = data.currentOrder.items.reduce((sum, i) => sum + (i.price * i.quantity), 0);
            const tax = subtotal * (data.settings.taxRate / 100);
            const total = subtotal + tax;

            document.getElementById('subtotal').textContent = subtotal.toFixed(2);
            document.getElementById('tax').textContent = tax.toFixed(2);
            document.getElementById('total').textContent = total.toFixed(2);
        }

        function clearOrder() {
            if (confirm('Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨ØŸ')) {
                data.currentOrder.items = [];
                renderOrder();
            }
        }

        function completeSale() {
            if (!data.currentOrder.table || data.currentOrder.items.length === 0) {
                alert('âš ï¸ Ø§Ù„Ø·Ù„Ø¨ ÙØ§Ø±Øº');
                return;
            }

            const tableId = data.currentOrder.table;
            const table = data.tables.find(t => t.id === tableId);
            
            // Calculate current order totals
            const currentSubtotal = data.currentOrder.items.reduce((sum, i) => sum + (i.price * i.quantity), 0);
            const currentTax = currentSubtotal * (data.settings.taxRate / 100);
            const currentTotal = currentSubtotal + currentTax;
            
            // Get previous order total if exists
            const previousTotal = data.tableOrders[tableId]?.total || 0;
            const previousSubtotal = data.tableOrders[tableId]?.subtotal || 0;
            const previousTax = data.tableOrders[tableId]?.tax || 0;
            
            // Calculate accumulated totals
            const accumulatedSubtotal = previousSubtotal + currentSubtotal;
            const accumulatedTax = previousTax + currentTax;
            const accumulatedTotal = previousTotal + currentTotal;
            
            // Combine items (previous + current)
            const previousItems = data.tableOrders[tableId]?.items || [];
            const allItems = [...previousItems, ...data.currentOrder.items];

            const sale = {
                id: Date.now(),
                date: new Date().toISOString(),
                table: table.name,
                items: allItems,
                subtotal: accumulatedSubtotal,
                tax: accumulatedTax,
                total: accumulatedTotal,
                employee: data.currentUser ? data.currentUser.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
                isAccumulated: previousTotal > 0 // Flag to show this is accumulated
            };

            // Update stock for current order only
            data.currentOrder.items.forEach(orderItem => {
                const menuItem = data.menu.find(m => m.id === orderItem.id);
                if (menuItem) menuItem.stock -= orderItem.quantity;
            });
            
            // Check if this is adding to existing order
            if (table.status === 'occupied' && previousTotal > 0) {
                // Store accumulated order temporarily
                data.tableOrders[tableId] = {
                    items: allItems,
                    subtotal: accumulatedSubtotal,
                    tax: accumulatedTax,
                    total: accumulatedTotal
                };
                
                saveData();
                
                // Show accumulated invoice
                showAccumulatedInvoice(sale, currentTotal, previousTotal);
                
                data.currentOrder = { table: null, items: [] };
                document.getElementById('currentTable').textContent = 'Ø§Ø®ØªØ± Ø·Ø§ÙˆÙ„Ø©';
                renderOrder();
                renderTables();
                renderMenu();
            } else {
                // First order - just mark as occupied and store
                table.status = 'occupied';
                
                data.tableOrders[tableId] = {
                    items: allItems,
                    subtotal: accumulatedSubtotal,
                    tax: accumulatedTax,
                    total: accumulatedTotal
                };
                
                // Add to sales (but don't finalize yet)
                saveData();
                showInvoice(sale);
                
                data.currentOrder = { table: null, items: [] };
                document.getElementById('currentTable').textContent = 'Ø§Ø®ØªØ± Ø·Ø§ÙˆÙ„Ø©';
                renderOrder();
                renderTables();
                renderMenu();
            }
            
            updateCash();
            updateReports();
        }

        function showInvoice(sale) {
            const content = document.getElementById('invoiceContent');
            content.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px; border-bottom: 2px dashed #333; padding-bottom: 15px;">
                    <h2>${data.settings.cafeName}</h2>
                    <p>${data.settings.cafeAddress}</p>
                    <p>${data.settings.cafePhone}</p>
                </div>
                <div style="margin-bottom: 20px;">
                    <p><strong>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©:</strong> ${sale.id}</p>
                    <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${new Date(sale.date).toLocaleString('ar-EG')}</p>
                    <p><strong>Ø§Ù„Ø·Ø§ÙˆÙ„Ø©:</strong> ${sale.table}</p>
                    <p><strong>Ø§Ù„ÙƒØ§Ø´ÙŠØ±:</strong> ${sale.employee}</p>
                </div>
                <table style="width: 100%; margin-bottom: 20px;">
                    <thead>
                        <tr style="border-bottom: 2px solid #333;">
                            <th style="padding: 10px; text-align: right;">Ø§Ù„ØµÙ†Ù</th>
                            <th style="padding: 10px; text-align: center;">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                            <th style="padding: 10px; text-align: center;">Ø§Ù„Ø³Ø¹Ø±</th>
                            <th style="padding: 10px; text-align: left;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${sale.items.map(i => `
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 8px;">${i.name}</td>
                                <td style="padding: 8px; text-align: center;">${i.quantity}</td>
                                <td style="padding: 8px; text-align: center;">${i.price.toFixed(2)}</td>
                                <td style="padding: 8px; text-align: left; font-weight: 700;">${(i.price * i.quantity).toFixed(2)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                <div style="text-align: left; font-size: 1.1em; border-top: 2px dashed #333; padding-top: 15px;">
                    <p style="margin: 5px 0;"><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</strong> ${sale.subtotal.toFixed(2)} Ø¬</p>
                    <p style="margin: 5px 0;"><strong>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (${data.settings.taxRate}%):</strong> ${sale.tax.toFixed(2)} Ø¬</p>
                    <p style="font-size: 1.4em; margin: 15px 0 5px 0; font-weight: 900;"><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong> ${sale.total.toFixed(2)} Ø¬</p>
                </div>
                <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px dashed #ccc;">
                    <p style="font-weight: 700;">Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ… â¤ï¸</p>
                    <p>Ù†ØªÙ…Ù†Ù‰ Ø±Ø¤ÙŠØªÙƒÙ… Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</p>
                </div>
            `;
            document.getElementById('invoiceModal').classList.add('active');
        }

        function closeInvoice() {
            document.getElementById('invoiceModal').classList.remove('active');
        }

        function showAccumulatedInvoice(sale, currentTotal, previousTotal) {
            const content = document.getElementById('invoiceContent');
            content.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px; border-bottom: 2px dashed #333; padding-bottom: 15px;">
                    <h2>${data.settings.cafeName}</h2>
                    <p>${data.settings.cafeAddress}</p>
                    <p>${data.settings.cafePhone}</p>
                </div>
                <div style="background: #fff3cd; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center;">
                    <h3 style="color: #856404; margin: 0;">ğŸ“‹ ÙØ§ØªÙˆØ±Ø© Ù…Ø¬Ù…Ø¹Ø©</h3>
                    <p style="margin: 5px 0; color: #856404;">ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø§ÙˆÙ„Ø©</p>
                </div>
                <div style="margin-bottom: 20px;">
                    <p><strong>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©:</strong> ${sale.id}</p>
                    <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${new Date(sale.date).toLocaleString('ar-EG')}</p>
                    <p><strong>Ø§Ù„Ø·Ø§ÙˆÙ„Ø©:</strong> ${sale.table}</p>
                    <p><strong>Ø§Ù„ÙƒØ§Ø´ÙŠØ±:</strong> ${sale.employee}</p>
                </div>
                
                <div style="background: #d1ecf1; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="margin: 0 0 10px 0; color: #0c5460;">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø§Ø¨Ù‚</h4>
                    <p style="font-size: 1.3em; font-weight: 700; margin: 0; color: #0c5460;">${previousTotal.toFixed(2)} Ø¬</p>
                </div>
                
                <div style="background: #d4edda; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <h4 style="margin: 0 0 10px 0; color: #155724;">Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯</h4>
                    <p style="font-size: 1.3em; font-weight: 700; margin: 0; color: #155724;">${currentTotal.toFixed(2)} Ø¬</p>
                </div>
                
                <table style="width: 100%; margin-bottom: 20px;">
                    <thead>
                        <tr style="border-bottom: 2px solid #333;">
                            <th style="padding: 10px; text-align: right;">Ø§Ù„ØµÙ†Ù</th>
                            <th style="padding: 10px; text-align: center;">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                            <th style="padding: 10px; text-align: center;">Ø§Ù„Ø³Ø¹Ø±</th>
                            <th style="padding: 10px; text-align: left;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${sale.items.map(i => `
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 8px;">${i.name}</td>
                                <td style="padding: 8px; text-align: center;">${i.quantity}</td>
                                <td style="padding: 8px; text-align: center;">${i.price.toFixed(2)}</td>
                                <td style="padding: 8px; text-align: left; font-weight: 700;">${(i.price * i.quantity).toFixed(2)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                <div style="text-align: left; font-size: 1.1em; border-top: 2px dashed #333; padding-top: 15px;">
                    <p style="margin: 5px 0;"><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</strong> ${sale.subtotal.toFixed(2)} Ø¬</p>
                    <p style="margin: 5px 0;"><strong>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (${data.settings.taxRate}%):</strong> ${sale.tax.toFixed(2)} Ø¬</p>
                    <p style="font-size: 1.6em; margin: 15px 0 5px 0; font-weight: 900; color: var(--primary);"><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ:</strong> ${sale.total.toFixed(2)} Ø¬</p>
                </div>
                <div style="text-align: center; margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 10px;">
                    <p style="font-weight: 700; margin: 0; color: #856404;">âš ï¸ Ø§Ù„Ø·Ø§ÙˆÙ„Ø© Ù„Ø§ ØªØ²Ø§Ù„ Ù…Ø´ØºÙˆÙ„Ø©</p>
                    <p style="margin: 5px 0 0 0; font-size: 0.9em; color: #856404;">Ø§Ø³ØªØ®Ø¯Ù… "ØªØ­Ø±ÙŠØ± Ø§Ù„Ø·Ø§ÙˆÙ„Ø©" Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø²Ø¨Ø§ÙŠÙ†</p>
                </div>
            `;
            document.getElementById('invoiceModal').classList.add('active');
        }

        // Inventory
        function renderInventory() {
            const tbody = document.getElementById('inventoryTable').querySelector('tbody');
            if (!tbody) {
                console.error('Inventory table body not found');
                return;
            }
            
            if (data.menu.length === 0) {
                const colSpan = (data.currentUser && data.currentUser.type === 'employee') ? 3 : 4;
                tbody.innerHTML = `<tr><td colspan="${colSpan}" style="text-align: center; padding: 20px; color: #999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØµÙ†Ø§Ù ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</td></tr>`;
                return;
            }
            
            const isEmployee = data.currentUser && data.currentUser.type === 'employee';
            
            tbody.innerHTML = data.menu.map(item => `
                <tr>
                    <td>${item.name}</td>
                    <td style="color: var(--success); font-weight: 700;">${item.price.toFixed(2)} Ø¬</td>
                    <td>${item.stock}</td>
                    ${isEmployee ? '' : `
                    <td>
                        <button class="btn btn-warning" style="padding: 5px 15px; font-size: 0.9em;" onclick="updateStock(${item.id})">ØªØ­Ø¯ÙŠØ«</button>
                        <button class="btn btn-danger" style="padding: 5px 15px; font-size: 0.9em;" onclick="deleteItem(${item.id})">Ø­Ø°Ù</button>
                    </td>
                    `}
                </tr>
            `).join('');
        }

        function addItem() {
            const name = document.getElementById('newItemName').value.trim();
            const price = parseFloat(document.getElementById('newItemPrice').value);
            const stock = parseInt(document.getElementById('newItemStock').value);

            console.log('Adding item:', { name, price, stock }); // Debug

            if (!name) {
                alert('âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù');
                return;
            }

            if (!price || price <= 0) {
                alert('âš ï¸ Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø± ØµØ­ÙŠØ­');
                return;
            }

            if (!stock || stock < 0) {
                alert('âš ï¸ Ø£Ø¯Ø®Ù„ ÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø©');
                return;
            }

            data.menu.push({
                id: Date.now(),
                name: name,
                price: price,
                stock: stock
            });

            console.log('Item added to menu:', data.menu); // Debug
            saveData();
            renderMenu();
            renderInventory();

            document.getElementById('newItemName').value = '';
            document.getElementById('newItemPrice').value = '';
            document.getElementById('newItemStock').value = '';

            alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙ†Ù Ø¨Ù†Ø¬Ø§Ø­');
        }

        function updateStock(id) {
            const item = data.menu.find(m => m.id === id);
            const newStock = prompt(`ØªØ­Ø¯ÙŠØ« ÙƒÙ…ÙŠØ© ${item.name}\nØ§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${item.stock}`, item.stock);
            
            if (newStock !== null) {
                const stock = parseInt(newStock);
                if (!isNaN(stock) && stock >= 0) {
                    item.stock = stock;
                    saveData();
                    renderMenu();
                    renderInventory();
                }
            }
        }

        function deleteItem(id) {
            if (confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙ†ÙØŸ')) {
                data.menu = data.menu.filter(m => m.id !== id);
                saveData();
                renderMenu();
                renderInventory();
            }
        }

        // Expenses
        function renderExpenses() {
            const tbody = document.getElementById('expensesTable').querySelector('tbody');
            if (data.expenses.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ±ÙˆÙØ§Øª</td></tr>';
                return;
            }
            tbody.innerHTML = data.expenses.slice().reverse().map(e => `
                <tr>
                    <td>${new Date(e.date).toLocaleDateString('ar-EG')}</td>
                    <td>${e.type}</td>
                    <td style="color: var(--danger); font-weight: 700;">${e.amount.toFixed(2)} Ø¬</td>
                    <td>${e.notes || '-'}</td>
                </tr>
            `).join('');
        }

        function addExpense() {
            const type = document.getElementById('expenseType').value;
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const notes = document.getElementById('expenseNotes').value;

            if (!type || !amount) {
                alert('âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                return;
            }

            data.expenses.push({
                id: Date.now(),
                date: new Date().toISOString(),
                type, amount, notes
            });

            saveData();
            renderExpenses();
            updateCash();
            updateReports();

            document.getElementById('expenseType').value = '';
            document.getElementById('expenseAmount').value = '';
            document.getElementById('expenseNotes').value = '';

            alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØµØ±ÙˆÙ');
        }

        // Employees
        function renderEmployees() {
            const container = document.getElementById('employeesContainer');
            if (!container) return; // Fallback for old HTML structure
            
            if (data.employees.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 40px; color: #999;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙŠÙ†</p>';
                return;
            }
            
            container.innerHTML = data.employees.map(e => `
                <div style="background: white; padding: 20px; border-radius: 15px; margin-bottom: 15px; border: 2px solid var(--border);">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                        <div>
                            <h3 style="color: var(--primary); margin-bottom: 10px;">ğŸ‘¤ ${e.name}</h3>
                            <p style="margin: 5px 0;"><strong>Ø§Ù„Ù…Ù†ØµØ¨:</strong> ${e.position}</p>
                            <p style="margin: 5px 0; color: var(--success); font-weight: 700;"><strong>Ø§Ù„Ø±Ø§ØªØ¨:</strong> ${e.salary.toFixed(2)} Ø¬</p>
                            <p style="margin: 5px 0; color: #666; font-size: 0.9em;"><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†:</strong> ${new Date(e.hireDate).toLocaleDateString('ar-EG')}</p>
                        </div>
                        <button class="btn btn-danger" style="padding: 10px 20px;" onclick="deleteEmployee(${e.id})">Ø­Ø°Ù</button>
                    </div>
                    <div style="background: var(--light); padding: 15px; border-radius: 10px;">
                        <strong style="color: var(--primary); display: block; margin-bottom: 10px;">ğŸ” ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</strong>
                        <div style="display: flex; gap: 10px;">
                            <input type="password" id="empPass_${e.id}" class="form-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©" style="flex: 1;">
                            <button class="btn btn-success" style="padding: 10px 20px;" onclick="updateEmployeePassword(${e.id})">ØªØ­Ø¯ÙŠØ«</button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Also render table if it exists
            const tbody = document.getElementById('employeesTable')?.querySelector('tbody');
            if (tbody) {
                if (data.employees.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙŠÙ†</td></tr>';
                } else {
                    tbody.innerHTML = data.employees.map(e => `
                        <tr>
                            <td>${e.name}</td>
                            <td>${e.position}</td>
                            <td style="color: var(--success); font-weight: 700;">${e.salary.toFixed(2)} Ø¬</td>
                            <td>${new Date(e.hireDate).toLocaleDateString('ar-EG')}</td>
                        </tr>
                    `).join('');
                }
            }
        }

        function addEmployee() {
            const name = document.getElementById('empName').value.trim();
            const position = document.getElementById('empPosition').value;
            const salary = parseFloat(document.getElementById('empSalary').value);
            const password = document.getElementById('empPasswordNew')?.value || '1234'; // Default password if field not found

            if (!name || !salary) {
                alert('âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }
            
            if (password.length < 4) {
                alert('âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 4 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }

            // Check if employee already exists
            if (data.employees.find(emp => emp.name === name)) {
                alert('âš ï¸ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸Ù Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙØ¹Ù„');
                return;
            }

            data.employees.push({
                id: Date.now(),
                name, 
                position, 
                salary,
                password: password, // Individual password for each employee
                hireDate: new Date().toISOString()
            });

            saveData();
            renderEmployees();

            document.getElementById('empName').value = '';
            document.getElementById('empSalary').value = '';
            if (document.getElementById('empPasswordNew')) {
                document.getElementById('empPasswordNew').value = '';
            }

            alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù');
        }
        
        function updateEmployeePassword(empId) {
            const newPassword = document.getElementById(`empPass_${empId}`).value;
            
            if (!newPassword) {
                alert('âš ï¸ Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©');
                return;
            }
            
            if (newPassword.length < 4) {
                alert('âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 4 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }
            
            const employee = data.employees.find(e => e.id === empId);
            if (employee) {
                employee.password = newPassword;
                saveData();
                document.getElementById(`empPass_${empId}`).value = '';
                alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
            }
        }
        
        function deleteEmployee(empId) {
            const employee = data.employees.find(e => e.id === empId);
            if (confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù ${employee.name}ØŸ`)) {
                data.employees = data.employees.filter(e => e.id !== empId);
                saveData();
                renderEmployees();
                alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù');
            }
        }

        // Reports
        function updateReports() {
            const totalSales = data.sales.reduce((sum, s) => sum + s.total, 0);
            const totalExpenses = data.expenses.reduce((sum, e) => sum + e.amount, 0);
            const profit = totalSales - totalExpenses;

            document.getElementById('reportSales').textContent = totalSales.toFixed(2);
            document.getElementById('reportExpenses').textContent = totalExpenses.toFixed(2);
            document.getElementById('reportProfit').textContent = profit.toFixed(2);

            const tbody = document.getElementById('salesTable').querySelector('tbody');
            if (data.sales.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª</td></tr>';
                return;
            }
            tbody.innerHTML = data.sales.slice().reverse().map(s => `
                <tr>
                    <td>${new Date(s.date).toLocaleString('ar-EG')}</td>
                    <td>${s.table}</td>
                    <td>${s.employee || '-'}</td>
                    <td style="color: var(--success); font-weight: 700;">${s.total.toFixed(2)} Ø¬</td>
                </tr>
            `).join('');
        }

        function updateCash() {
            if (data.currentUser && data.currentUser.type === 'employee') {
                document.getElementById('totalCash').textContent = '***';
                return;
            }
            const totalSales = data.sales.reduce((sum, s) => sum + s.total, 0);
            const totalExpenses = data.expenses.reduce((sum, e) => sum + e.amount, 0);
            document.getElementById('totalCash').textContent = (totalSales - totalExpenses).toFixed(2);
        }

        // Daily Reports
        function generateTodayReport() {
            const today = new Date();
            const dateString = today.toISOString().split('T')[0];
            document.getElementById('dailyReportDate').value = dateString;
            generateDailyReport();
        }

        function generateDailyReport() {
            const selectedDate = document.getElementById('dailyReportDate').value;
            
            if (!selectedDate) {
                alert('âš ï¸ Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }

            // Parse the selected date
            const reportDate = new Date(selectedDate);
            
            // Filter sales for the selected day
            const dailySales = data.sales.filter(sale => {
                const saleDate = new Date(sale.date);
                return saleDate.toDateString() === reportDate.toDateString();
            });

            // Filter expenses for the selected day
            const dailyExpenses = data.expenses.filter(expense => {
                const expenseDate = new Date(expense.date);
                return expenseDate.toDateString() === reportDate.toDateString();
            });

            // Calculate totals
            const totalSales = dailySales.reduce((sum, s) => sum + s.total, 0);
            const totalExpenses = dailyExpenses.reduce((sum, e) => sum + e.amount, 0);
            const profit = totalSales - totalExpenses;

            // Show the report container
            document.getElementById('dailyReportContainer').style.display = 'block';

            // Update stats (hide for employees)
            const statsContainer = document.getElementById('dailyReportStats');
            if (data.currentUser && data.currentUser.type === 'employee') {
                statsContainer.style.display = 'none';
            } else {
                statsContainer.style.display = 'grid';
                statsContainer.innerHTML = `
                    <div style="background: var(--success); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 1.5em; font-weight: 900;">${totalSales.toFixed(2)} Ø¬</div>
                        <div style="margin-top: 10px;">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div>
                    </div>
                    <div style="background: var(--danger); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 1.5em; font-weight: 900;">${totalExpenses.toFixed(2)} Ø¬</div>
                        <div style="margin-top: 10px;">Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div>
                    </div>
                    <div style="background: var(--primary); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 1.5em; font-weight: 900;">${profit.toFixed(2)} Ø¬</div>
                        <div style="margin-top: 10px;">Ø§Ù„Ø±Ø¨Ø­</div>
                    </div>
                `;
            }

            // Update table
            const tbody = document.getElementById('dailyReportTable').querySelector('tbody');
            if (dailySales.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</td></tr>';
            } else {
                tbody.innerHTML = dailySales.map(sale => `
                    <tr>
                        <td>${new Date(sale.date).toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' })}</td>
                        <td>${sale.table}</td>
                        <td>${sale.employee || '-'}</td>
                        <td style="color: var(--success); font-weight: 700;">${sale.total.toFixed(2)} Ø¬</td>
                    </tr>
                `).join('');
            }
        }

        // Settings
        function saveSettings() {
            data.settings.cafeName = document.getElementById('cafeName').value;
            data.settings.cafePhone = document.getElementById('cafePhone').value;
            data.settings.cafeAddress = document.getElementById('cafeAddress').value;
            data.settings.taxRate = parseFloat(document.getElementById('taxRate').value);
            saveData();
            alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
        }

        function savePasswords() {
            const adminPass = document.getElementById('adminPassword').value;
            const empPass = document.getElementById('employeePassword').value;

            if (adminPass && adminPass.length >= 4) {
                data.settings.adminPassword = adminPass;
            }

            if (empPass && empPass.length >= 4) {
                data.settings.employeePassword = empPass;
            }

            if (!adminPass && !empPass) {
                alert('âš ï¸ Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }

            saveData();
            document.getElementById('adminPassword').value = '';
            document.getElementById('employeePassword').value = '';
            alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±');
        }

        function resetData() {
            // Create a custom dialog with checkboxes
            const dialog = document.createElement('div');
            dialog.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 10000;';
            
            dialog.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 20px; max-width: 500px; width: 90%;">
                    <h2 style="color: var(--danger); text-align: center; margin-bottom: 20px;">âš ï¸ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
                    <p style="text-align: center; margin-bottom: 20px;">Ø§Ø®ØªØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ù…Ø³Ø­Ù‡Ø§:</p>
                    <div style="text-align: right;">
                        <label style="display: block; padding: 15px; background: var(--light); margin-bottom: 10px; border-radius: 10px; cursor: pointer;">
                            <input type="checkbox" id="resetSales" style="margin-left: 10px; width: 20px; height: 20px;">
                            <span>Ù…Ø³Ø­ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</span>
                        </label>
                        <label style="display: block; padding: 15px; background: var(--light); margin-bottom: 10px; border-radius: 10px; cursor: pointer;">
                            <input type="checkbox" id="resetExpenses" style="margin-left: 10px; width: 20px; height: 20px;">
                            <span>Ù…Ø³Ø­ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</span>
                        </label>
                        <label style="display: block; padding: 15px; background: var(--light); margin-bottom: 10px; border-radius: 10px; cursor: pointer;">
                            <input type="checkbox" id="resetInventory" style="margin-left: 10px; width: 20px; height: 20px;">
                            <span>Ù…Ø³Ø­ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</span>
                        </label>
                        <label style="display: block; padding: 15px; background: var(--light); margin-bottom: 10px; border-radius: 10px; cursor: pointer;">
                            <input type="checkbox" id="resetEmployees" style="margin-left: 10px; width: 20px; height: 20px;">
                            <span>Ù…Ø³Ø­ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</span>
                        </label>
                        <label style="display: block; padding: 15px; background: var(--light); margin-bottom: 10px; border-radius: 10px; cursor: pointer;">
                            <input type="checkbox" id="resetTables" style="margin-left: 10px; width: 20px; height: 20px;">
                            <span>Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø·Ø§ÙˆÙ„Ø§Øª</span>
                        </label>
                        <label style="display: block; padding: 15px; background: #ffe6e6; margin-bottom: 20px; border-radius: 10px; cursor: pointer;">
                            <input type="checkbox" id="resetAll" style="margin-left: 10px; width: 20px; height: 20px;">
                            <span style="color: var(--danger); font-weight: 700;">Ù…Ø³Ø­ ÙƒÙ„ Ø´ÙŠØ¡ (Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª)</span>
                        </label>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <button class="btn btn-danger" onclick="confirmResetData()" style="width: 100%;">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ø³Ø­</button>
                        <button class="btn btn-primary" onclick="closeResetDialog()" style="width: 100%;">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(dialog);
            window.resetDialog = dialog;
        }
        
        function closeResetDialog() {
            if (window.resetDialog) {
                window.resetDialog.remove();
                window.resetDialog = null;
            }
        }
        
        function confirmResetData() {
            const resetSales = document.getElementById('resetSales')?.checked;
            const resetExpenses = document.getElementById('resetExpenses')?.checked;
            const resetInventory = document.getElementById('resetInventory')?.checked;
            const resetEmployees = document.getElementById('resetEmployees')?.checked;
            const resetTables = document.getElementById('resetTables')?.checked;
            const resetAll = document.getElementById('resetAll')?.checked;
            
            if (!resetSales && !resetExpenses && !resetInventory && !resetEmployees && !resetTables && !resetAll) {
                alert('âš ï¸ Ø§Ø®ØªØ± Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ø³Ø­');
                return;
            }
            
            let confirmMsg = 'ØªØ£ÙƒÙŠØ¯ Ù…Ø³Ø­:\n';
            if (resetAll) {
                confirmMsg += 'â€¢ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª\n';
            } else {
                if (resetSales) confirmMsg += 'â€¢ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª\n';
                if (resetExpenses) confirmMsg += 'â€¢ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª\n';
                if (resetInventory) confirmMsg += 'â€¢ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†\n';
                if (resetEmployees) confirmMsg += 'â€¢ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†\n';
                if (resetTables) confirmMsg += 'â€¢ Ø§Ù„Ø·Ø§ÙˆÙ„Ø§Øª\n';
            }
            confirmMsg += '\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!';
            
            if (!confirm(confirmMsg)) return;
            
            if (resetAll) {
                localStorage.clear();
                location.reload();
                return;
            }
            
            // Selective reset
            if (resetSales) {
                data.sales = [];
            }
            if (resetExpenses) {
                data.expenses = [];
            }
            if (resetInventory) {
                data.menu = [];
            }
            if (resetEmployees) {
                data.employees = [];
            }
            if (resetTables) {
                data.tables = [];
                for (let i = 1; i <= 20; i++) {
                    data.tables.push({ id: i, name: `Ø·Ø§ÙˆÙ„Ø© ${i}`, status: 'available' });
                }
                data.currentOrder = { table: null, items: [] };
            }
            
            saveData();
            closeResetDialog();
            
            // Refresh displays
            renderTables();
            renderMenu();
            renderInventory();
            renderEmployees();
            renderExpenses();
            updateReports();
            updateCash();
            
            alert('âœ… ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©');
        }

        // Navigation
        function showTab(tabName) {
            // Check permissions
            if (data.currentUser && data.currentUser.type === 'employee') {
                if (tabName === 'expenses' || tabName === 'employees' || tabName === 'settings') {
                    alert('âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù…ØªØ§Ø­Ø© Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·');
                    return;
                }
            }

            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'reports') {
                updateReports();
                // Hide financial stats for employees
                if (data.currentUser && data.currentUser.type === 'employee') {
                    const financialStats = document.getElementById('financialStats');
                    if (financialStats) {
                        financialStats.style.display = 'none';
                    }
                }
            }
        }

        // Load settings on page load
        window.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded');
            
            // Load settings to form
            setTimeout(() => {
                if (data.settings) {
                    document.getElementById('cafeName').value = data.settings.cafeName;
                    document.getElementById('cafePhone').value = data.settings.cafePhone;
                    document.getElementById('cafeAddress').value = data.settings.cafeAddress;
                    document.getElementById('taxRate').value = data.settings.taxRate;
                }
            }, 100);
            
            init();
        });
    </script>
</body>
</html>
